# 自動回覆系統故障排除指南

## 🔍 常見問題診斷

### 問題 1：網頁控制台顯示"載入失敗"

#### 可能原因：
1. 機器人未啟動
2. 網頁服務器未運行
3. 未登錄或 session 過期
4. 網絡連接問題

#### 解決步驟：

**步驟 1：檢查機器人狀態**
```bash
# 確認機器人正在運行
# 終端應該顯示類似：
# 📦 auto_reply cog已載入
```

**步驟 2：檢查網頁服務器**
```bash
# 終端應該顯示：
# 🌐 網頁控制台已啟動: http://0.0.0.0:8080
```

**步驟 3：檢查瀏覽器控制台**
1. 按 `F12` 打開開發者工具
2. 切換到 `Console` 標籤
3. 查看錯誤訊息：
   - 紅色錯誤訊息會顯示具體問題
   - 如果看到 `401 Unauthorized` → 請重新登錄
   - 如果看到 `404 Not Found` → API 路徑問題
   - 如果看到 `500 Internal Server Error` → 服務器錯誤

**步驟 4：重新登錄**
1. 點擊右上角登出
2. 重新登錄
3. 選擇服務器

---

### 問題 2：添加規則提示"操作失敗"

#### 可能原因：
1. 觸發詞為空
2. 回覆內容為空（非反應類型）
3. 服務器錯誤
4. 數據格式問題

#### 解決步驟：

**步驟 1：檢查輸入**
- ✅ 觸發詞必須填寫
- ✅ 如果回覆類型不是"添加反應"，回覆內容必須填寫
- ✅ 正則表達式語法必須正確

**步驟 2：查看瀏覽器控制台**
1. 按 `F12` 打開開發者工具
2. 查看 `Console` 標籤的錯誤訊息
3. 查看 `Network` 標籤：
   - 找到 `/api/auto-reply/` 請求
   - 點擊查看 `Response`
   - 查看具體錯誤原因

**步驟 3：檢查服務器日誌**
- 查看 Python 終端輸出
- 尋找紅色錯誤訊息

---

### 問題 3：規則不觸發

#### 可能原因：
1. 系統被停用
2. 規則被停用
3. 匹配條件不符
4. 頻道/角色限制

#### 解決步驟：

**步驟 1：檢查系統狀態**
- 網頁控制台 → 自動回覆
- 確認系統狀態為 🟢 已啟用

**步驟 2：檢查規則狀態**
- 確認規則顯示 🟢 而不是 🔴
- 點擊"啟用"按鈕切換狀態

**步驟 3：檢查匹配條件**
```
完全匹配 (exact)     - 消息必須與觸發詞完全相同
包含關鍵詞 (contains) - 消息中包含觸發詞即可
以...開頭 (starts_with) - 消息必須以觸發詞開頭
以...結尾 (ends_with)   - 消息必須以觸發詞結尾
正則表達式 (regex)     - 使用正則匹配
```

**步驟 4：測試觸發**
1. 在 Discord 頻道發送測試消息
2. 檢查規則的觸發次數是否增加
3. 如果沒有，檢查：
   - 區分大小寫設置
   - 頻道限制
   - 角色限制

---

## 🛠️ 調試技巧

### 使用瀏覽器開發者工具

**打開方式：**
- Windows/Linux: `F12` 或 `Ctrl+Shift+I`
- Mac: `Cmd+Option+I`

**Console 標籤：**
- 查看 JavaScript 錯誤
- 所有 API 錯誤都會記錄在這裡
- 尋找以 `載入自動回覆數據失敗:` 開頭的訊息

**Network 標籤：**
1. 刷新頁面
2. 找到 `/api/auto-reply/` 請求
3. 查看：
   - Status: 應該是 200
   - Response: 查看返回的數據
   - Headers: 檢查請求頭

### 檢查數據文件

自動回覆數據存儲在：
```
./data/{guild_id}/auto_reply.json
```

**文件結構：**
```json
{
  "enabled": true,
  "rules": [
    {
      "id": 1,
      "trigger": "hello",
      "reply": "Hi there!",
      "match_type": "contains",
      "reply_type": "message",
      "enabled": true,
      "triggered_count": 5
    }
  ]
}
```

**手動檢查：**
1. 打開文件查看內容
2. 確認 JSON 格式正確
3. 檢查規則是否存在

---

## 📞 獲取幫助

### 提供以下信息：

1. **錯誤訊息截圖**
   - 網頁顯示的錯誤
   - 瀏覽器 Console 的錯誤

2. **系統信息**
   - 機器人版本
   - Python 版本
   - 操作系統

3. **重現步驟**
   - 詳細描述操作步驟
   - 何時出現錯誤

4. **日誌文件**
   - Python 終端輸出
   - 瀏覽器 Console 輸出

---

## ✅ 自檢清單

在報告問題前，請確認：

- [ ] 機器人正在運行
- [ ] 網頁服務器已啟動
- [ ] 已登錄到網頁控制台
- [ ] 選擇了正確的服務器
- [ ] 檢查了瀏覽器 Console
- [ ] 檢查了服務器終端輸出
- [ ] 已重新整理頁面
- [ ] 已重新登錄
- [ ] 已重啟機器人（如需要）

---

## 🔧 版本 2.8.2 改進

### 新增的錯誤處理功能：

1. **詳細錯誤顯示**
   - HTTP 狀態碼顯示
   - 具體錯誤原因
   - 重試按鈕

2. **控制台日誌**
   - 所有錯誤記錄到 Console
   - API 請求狀態記錄
   - 數據驗證記錄

3. **用戶友好提示**
   - 明確的錯誤訊息
   - 視覺反饋（顏色、Emoji）
   - 操作建議

---

## 💡 最佳實踐

1. **定期備份數據**
   ```bash
   # 備份所有數據
   cp -r ./data ./data_backup
   ```

2. **測試規則**
   - 先創建簡單規則測試
   - 確認工作後再添加複雜規則

3. **監控觸發次數**
   - 定期檢查規則的觸發次數
   - 刪除不需要的規則

4. **使用描述性觸發詞**
   - 清晰明確
   - 避免過於寬泛的匹配

5. **小心使用正則表達式**
   - 先在在線工具測試
   - 避免過於複雜的模式
